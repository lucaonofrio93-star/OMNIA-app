<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMNIA - Accademia Avanzata</title>
    <style>
        body { background: #050505; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; }
        nav { display: flex; gap: 20px; margin-bottom: 30px; padding: 15px; background: #111; border-radius: 10px; }
        button { cursor: pointer; transition: 0.3s; }
        .nav-btn { background: none; border: none; color: #888; font-size: 1rem; }
        .nav-btn.active { color: white; font-weight: bold; border-bottom: 2px solid #008C45; }
        .page { display: none; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .categories-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .category-card { background: #151515; padding: 25px; border-radius: 15px; border: 1px solid #333; text-align: center; }
        #refreshBtn { background: #008C45; color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.1rem; margin-bottom: 30px; }
        input { background: #222; border: 1px solid #444; color: white; padding: 12px; width: 300px; border-radius: 5px; margin: 10px 0; }
        .pill-card { background: #1a1a1a; padding: 20px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid #008C45; }
    </style>
</head>
<body>

    <nav>
        <button class="nav-btn active" onclick="showPage('home')">üè† Home</button>
        <button class="nav-btn" onclick="showPage('archive')">üìÇ Archivio</button>
        <button class="nav-btn" onclick="showPage('settings')">‚öôÔ∏è Impostazioni</button>
    </nav>

    <section id="homePage" class="page active">
        <div style="text-align: center;">
            <h1>OMNIA</h1>
            <p style="color: #888;">Alta Formazione Interdisciplinare</p>
            <button id="refreshBtn" onclick="refreshPills()">üîÑ Aggiorna Conoscenza</button>
        </div>
        <div id="categoriesGrid" class="categories-grid"></div>
    </section>

    <section id="archivePage" class="page">
        <h2>Il tuo Archivio</h2>
        <div id="pillsList"></div>
    </section>

    <section id="settingsPage" class="page">
        <h2>Configurazione API</h2>
        <div style="background: #111; padding: 30px; border-radius: 15px; border: 1px solid #333;">
            <p>Incolla qui la tua API Key di Gemini (presa da Google AI Studio):</p>
            <input type="password" id="apiKeyInput" placeholder="AIzaSy...">
            <br>
            <button onclick="saveApiKey()" style="background: #4A90E2; color: white; border: none; padding: 10px 30px; border-radius: 5px; margin-top: 10px;">Salva Chiave</button>
            <p id="saveStatus" style="color: #2ECC71; display: none;">‚úÖ Chiave salvata correttamente!</p>
        </div>
    </section>

    <script>
        const CATEGORIES = {
            storia_it: { title: 'Storia Italiana', icon: 'üáÆüáπ', color: '#008C45' },
            geopolitica: { title: 'Geopolitica', icon: 'üåê', color: '#4A90E2' },
            attualita: { title: 'Attualit√†', icon: 'üì∞', color: '#E74C3C' },
            letteratura: { title: 'Letteratura', icon: 'üìö', color: '#F1C40F' },
            arte: { title: 'Cultura Artistica', icon: 'üé®', color: '#9B59B6' },
            musica: { title: 'Cultura Musicale', icon: 'üéµ', color: '#2ECC71' }
        };

        let state = {
            pills: JSON.parse(localStorage.getItem('omnia_pills')) || [],
            apiKey: localStorage.getItem('omnia_api_key') || ''
        };

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id + 'Page').classList.add('active');
            event.target.classList.add('active');
            if(id === 'archive') renderArchive();
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value;
            localStorage.setItem('omnia_api_key', key);
            state.apiKey = key;
            document.getElementById('saveStatus').style.display = 'block';
            setTimeout(() => document.getElementById('saveStatus').style.display = 'none', 3000);
        }

        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = '';
            Object.entries(CATEGORIES).forEach(([key, cat]) => {
                const count = state.pills.filter(p => p.category === key).length;
                grid.innerHTML += `
                    <div class="category-card" style="border-top: 4px solid ${cat.color}">
                        <div style="font-size: 2.5rem">${cat.icon}</div>
                        <h3>${cat.title}</h3>
                        <p style="color: #888">${count} pillole archiviate</p>
                    </div>
                `;
            });
        }

        async function refreshPills() {
            if(!state.apiKey) return alert("Inserisci l'API Key nelle Impostazioni!");
            const btn = document.getElementById('refreshBtn');
            btn.textContent = '‚è≥ Consultazione Accademica...';
            
            try {
                for (let [id, cat] of Object.entries(CATEGORIES)) {
                    const prompt = `Genera un'analisi accademica avanzata (3 paragrafi) su un tema di ${cat.title}. Rispondi solo in JSON: {"title": "...", "content": "..."}`;
                    const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.apiKey}`, {
                        method: 'POST',
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await resp.json();
                    const text = data.candidates[0].content.parts[0].text;
                    const cleanJson = JSON.parse(text.match(/\{[\s\S]*\}/)[0]);
                    
                    state.pills.push({ ...cleanJson, category: id, date: new Date().toLocaleDateString() });
                }
                localStorage.setItem('omnia_pills', JSON.stringify(state.pills));
                renderCategories();
            } catch (e) {
                alert("Errore di connessione. Controlla la chiave.");
            } finally {
                btn.textContent = 'üîÑ Aggiorna Conoscenza';
            }
        }

        function renderArchive() {
            const list = document.getElementById('pillsList');
            list.innerHTML = state.pills.map(p => `
                <div class="pill-card" style="border-left-color: ${CATEGORIES[p.category].color}">
                    <h3 style="margin:0">${p.title}</h3>
                    <p>${p.content}</p>
                    <small style="color: #666">${CATEGORIES[p.category].title} ‚Ä¢ ${p.date}</small>
                </div>
            `).join('');
        }

        // Init
        renderCategories();
        if(state.apiKey) document.getElementById('apiKeyInput').value = state.apiKey;
    </script>
</body>
</html>
